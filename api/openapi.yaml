openapi: 3.0.1
info:
  contact:
    email: zkong@gsma.com
    name: Zhen Kong
  description: This is the REST api specification for the Common-adapter layer
  title: Common-Adapter
  version: 0.0.1
servers:
- url: /api/v1/
tags:
- description: Receive Notification From Offchain Comms
  name: event
- description: Access to Contract Object
  name: contract
- description: Access to Signature of Contract
  name: signature
- description: Access to Usage of Contract
  name: usage
- description: Access to Settlement of Contract
  name: settlement
- description: Access to API status information
  name: status
- description: Access to discovery information
  name: discovery

paths:
  /discovery/msps:
    get:
      description: Show a list of all Msps
      operationId: getDiscoveryMsps
      responses:
        "200":
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
              example: ['GSMA', 'AnotherMSP']
          description: A list of all discovered Msps
        "500":
          content: {}
          description: Internal Error
      tags:
      - discovery
      x-eov-operation-handler: controllers/DiscoveryController
  /discovery/msps/{mspId}:
    get:
      description: Show details for a specific Msp
      operationId: getDiscoveryMsp
      parameters:
      - description: Name of a Msp
        explode: false
        in: path
        name: mspId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Msp'
          description: Details about the requested Msp
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - discovery
      x-eov-operation-handler: controllers/DiscoveryController
  /status:
    get:
      description: Show version information of the API
      operationId: getApiStatus
      responses:
        "200":
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                properties:
                  commitHash:
                    type: string
                  apiHash:
                    type: string
                  apiVersion:
                    type: string
                example:
                  commitHash: "unknown"
                  apiHash: "unknown"
                  apiVersion: "?.?.?"
          description: The status of the service
        "500":
          content: {}
          description: Internal Error
      tags:
      - status
      x-eov-operation-handler: controllers/StatusController
  /contracts/event/:
    post:
      description: Webhook callback
      operationId: eventReceived
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Event'
        description: Webhook event Object Payload
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventResponse'
          description: Successful operation, returns list of uploaded documents
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - event
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/EventController
  /contracts/:
    get:
      description: Show a list of all Contracts
      operationId: getContracts
      parameters:
      - description: One or more MSPs
        in: query
        name: withMSPs
        schema:
          type: array
          items:
            type: string
        style: pipeDelimited
        explode: false
        examples:
          oneMSP:
            summary: Example of a single MSP
            value: ['GSMA']
          multipleMSPs:
            summary: Example of multiple MSPs
            value: ['GSMA', 'OrdererMSP']
      - description: One or more states
        in: query
        name: states
        schema:
          type: array
          items:
            type: string
        style: pipeDelimited
        explode: false
        examples:
          oneState:
            summary: Example of a single state
            value: ['DRAFT']
          multipleStates:
            summary: Example of multiple states
            value: ['SENT', 'RECEIVED']
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractListResponse'
                x-content-type: application/json
          description: The status of the service
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-eov-operation-handler: controllers/ContractController
    post:
      description: Create a new Contract
      operationId: createContract
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractRequest'
        description: Contract Object Payload
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractResponse'
                x-content-type: application/json
          description: Successful operation, returns created Contract Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/ContractController
  /contracts/{contractId}:
    delete:
      description: Delete a Contract By its Id
      operationId: deleteContractById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractResponse'
                x-content-type: application/json
          description: The Deleted Conctact Object
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-eov-operation-handler: controllers/ContractController
    get:
      description: Get a Contract By its Id
      operationId: getContractById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: Response format, defaults to JSON if not passed.
        explode: true
        in: query
        name: format
        required: false
        schema:
          type: string
          enum: [JSON, RAW]
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractResponseOrRAWContractResponse'
                x-content-type: application/json
          description: The Selected Contract Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-eov-operation-handler: controllers/ContractController
    put:
      description: Update existing Contract
      operationId: updateContractById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContractRequest'
        description: Contract Object Payload
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractResponse'
                x-content-type: application/json
          description: Successful operation, returns updated Contract Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/ContractController
  /contracts/{contractId}/send/:
    put:
      description: Set State to "SEND" and POST to Blochain adapter towards TargetMsp of the Contract 
      operationId: sendContractById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContractResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Contract Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - contract
      x-eov-operation-handler: controllers/ContractController
  /contracts/{contractId}/signatures/:
    get:
      description: Get All signatures of a given Contract
      operationId: getSignatures
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureListResponse'
                x-content-type: application/json
          description: List of available Signatures
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-eov-operation-handler: controllers/SignatureController
    post:
      description: Create/Upload Signature
      operationId: createSignature
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureRequest'
        description: Signature Object Payload
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureResponse'
          description: Successful operation, returns updated Signature Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/SignatureController
  /contracts/{contractId}/signatures/{signatureId}:
    get:
      description: Get Signature Object by its Id
      operationId: getSignatureById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The Signature Id
          explode: false
          in: path
          name: signatureId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureResponse'
                x-content-type: application/json
          description: The Selected Signature Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-eov-operation-handler: controllers/SignatureController
  /contracts/{contractId}/usages/{usageId}/signatures/:
    get:
      description: Get All signatures of a given Usage
      operationId: getUsageSignatures
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The usage Id
          explode: false
          in: path
          name: usageId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                type: string
                x-content-type: application/json
          description: List of available Signatures
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-eov-operation-handler: controllers/SignatureController
    post:
      description: Create/Upload Signature
      operationId: createUsageSignature
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The usage Id
          explode: false
          in: path
          name: usageId
          required: true
          schema:
            type: string
          style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignatureRequest'
        description: Signature Object Payload
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureResponse'
          description: Successful operation, returns updated Signature Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/SignatureController
  /contracts/{contractId}/usages/{usageId}/signatures/{signatureId}:
    get:
      description: Get Signature Object by its Id
      operationId: getUsageSignatureById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The usage Id
          explode: false
          in: path
          name: usageId
          required: true
          schema:
            type: string
          style: simple
        - description: The Signature Id
          explode: false
          in: path
          name: signatureId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignatureResponse'
                x-content-type: application/json
          description: The Selected Signature Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - signature
      x-eov-operation-handler: controllers/SignatureController
  /contracts/{contractId}/usages/:
    get:
      description: Get All usage of a given Contract
      operationId: getUsages
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: One or more states
        in: query
        name: states
        schema:
          type: array
          items:
            type: string
        style: pipeDelimited
        explode: false
        examples:
          oneState:
            summary: Example of a single state
            value: ['DRAFT']
          multipleStates:
            summary: Example of multiple states
            value: ['SENT', 'RECEIVED']
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageListResponse'
          description: List of available Usages
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-eov-operation-handler: controllers/UsageController
    post:
      description: Create a new Usage
      operationId: createUsage
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsageRequest'
        description: Usage Object Payload
        required: true
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: Successful operation, returns created Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/usages/{usageId}:
    get:
      description: Get Usage Object by its Id
      operationId: getUsageById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Usage Id
        explode: false
        in: path
        name: usageId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: The Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-eov-operation-handler: controllers/UsageController
    put:
      description: Update Usage Object by its Id
      operationId: updateUsageById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Usage Id
        explode: false
        in: path
        name: usageId
        required: true
        schema:
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UsageRequest'
        description: Usage Object Payload
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: Successful operation, returns updated Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-codegen-request-body-name: body
      x-eov-operation-handler: controllers/UsageController
    delete:
      description: Delete a Usage By its Id
      operationId: deleteUsageById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Usage Id
        explode: false
        in: path
        name: usageId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: The Deleted Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/usages/{usageId}/discrepancy/:
    get:
      description: Get the discrepancy between an usage and a given partner usage. 
      operationId: getUsageDiscrepancy
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Usage Id
        explode: false
        in: path
        name: usageId
        required: true
        schema:
          type: string
        style: simple
      - description: The id of the partner usage to compare
        explode: false
        in: query
        name: partnerUsageId
        required: true
        schema:
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageDiscrepancy'
                x-content-type: application/json
          description: Successful operation, returns the usage discrepancy Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/usages/{usageId}/generate/:
    put:
      description: Generate the "Settlement" with local calculator and POST to Blochain adapter towards TargetMsp of the calculated response. 
      operationId: generateUsageById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Usage Id
        explode: false
        in: path
        name: usageId
        required: true
        schema:
          type: string
        style: simple
      - description: By default, for undefined mode, will calculate and store a new settlement. If "preview" mode is selected, will not store the calculated settlement. If "commit" mode is selected, will store and send the calculated settlement.
        explode: true
        in: query
        name: mode
        required: false
        schema:
          type: string
          enum: [preview, commit]
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - usage
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/usages/{usageId}/send/:
    put:
      description: Set State to "SEND" and POST to Blockchain adapter towards TargetMsp of the Usage
      operationId: sendUsageById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The Usage Id
          explode: false
          in: path
          name: usageId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - usage
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/usages/{usageId}/reject/:
    put:
      description: Set Tag to "REJECTED"
      operationId: rejectUsageById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The Usage Id
          explode: false
          in: path
          name: usageId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsageResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Usage Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - usage
      x-eov-operation-handler: controllers/UsageController
  /contracts/{contractId}/settlements/:
    get:
      description: Get All Settlement of a given Contract
      operationId: getSettlements
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementListResponse'
                x-content-type: application/json
          description: List of available Settlements
        "500":
          content: {}
          description: Internal Error
      tags:
      - settlement
      x-eov-operation-handler: controllers/SettlementController
  /contracts/{contractId}/settlements/{settlementId}:
    get:
      description: Get Settlement Object by its Id
      operationId: getSettlementById
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Settlement Id
        explode: false
        in: path
        name: settlementId
        required: true
        schema:
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementResponse'
                x-content-type: application/json
          description: The Settlement Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - settlement
      x-eov-operation-handler: controllers/SettlementController
  /contracts/{contractId}/settlements/{settlementId}/discrepancy/:
    get:
      description: Get the discrepancy between a settlement and a given partner settlement. 
      operationId: getSettlementDiscrepancy
      parameters:
      - description: The contract Id
        explode: false
        in: path
        name: contractId
        required: true
        schema:
          type: string
        style: simple
      - description: The Settlement Id
        explode: false
        in: path
        name: settlementId
        required: true
        schema:
          type: string
        style: simple
      - description: The id of the partner settlement to compare
        explode: false
        in: query
        name: partnerSettlementId
        required: true
        schema:
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementDiscrepancy'
                x-content-type: application/json
          description: Successful operation, returns the settlement discrepancy Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
      - settlement
      x-eov-operation-handler: controllers/SettlementController
  /contracts/{contractId}/settlements/{settlementId}/send/:
    put:
      description: Set State to "SEND" and POST to Blockchain adapter towards TargetMsp of the Usage
      operationId: sendSettlementById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The Settlement Id
          explode: false
          in: path
          name: settlementId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Settlement Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - settlement
      x-eov-operation-handler: controllers/SettlementController
  /contracts/{contractId}/settlements/{settlementId}/reject/:
    put:
      description: Set Tag to "REJECTED"
      operationId: rejectSettlementById
      parameters:
        - description: The contract Id
          explode: false
          in: path
          name: contractId
          required: true
          schema:
            type: string
          style: simple
        - description: The Settlement Id
          explode: false
          in: path
          name: settlementId
          required: true
          schema:
            type: string
          style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettlementResponse'
                x-content-type: application/json
          description: Successful operation, returns sent Settlement Object
        "400":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/400ErrorResponse'
                x-content-type: application/json
          description: Bad Request
        "500":
          content: {}
          description: Internal Error
      tags:
        - settlement
      x-eov-operation-handler: controllers/SettlementController


components:
  schemas:
    StringOrNull:
      title: A string value or null
      type: string
      nullable: true

    ObjectOrNull:
      title: An object or null
      type: object
      nullable: true
      additionalProperties: true
    
    Date:
      title: Formatted date JSON
      type: string
      example: 2021-01-01T15:30:10.801Z
    
    BlockchainRef:
      title: BlockchainRef object JSON
      type: object
      additionalProperties: true

    Msp:
      title: Msp JSON
      type: object
      additionalProperties: true
      properties:
        id:
          type: string
        name:
          type: string
        organizationalUnitIdentifiers:
          type: array
          items:
            type: string
        rootCerts:
          type: string
        intermediateCerts:
          type: string
        admins:
          type: string
        tlsRootCerts:
          type: string
        tlsIntermediateCerts:
          type: string
      example:
        id: GSMA
        name: GSMA
        organizationalUnitIdentifiers: []
        rootCerts: "-----BEGIN CERTIFICATE-----\nMIIC...==\n-----END CERTIFICATE-----\n"
        intermediateCerts: intermediateCerts
        admins: admins
        tlsRootCerts: "-----BEGIN CERTIFICATE-----\nMIIC...==\n-----END CERTIFICATE-----\n"
        tlsIntermediateCerts: tlsIntermediateCerts

    Event:
      title: Event JSON
      type: object
      additionalProperties: true
      properties:
        msp:
          type: string
        eventName:
          type: string
        timestamp:
          type: string
        data:
          type: object
          additionalProperties: true
          properties:
            storageKey:
              type: string
      example:
        msp: eventMsp
        eventName: STORE:PAYLOADLINK
        timestamp: '2020-11-30T16:59:35Z'
        data:
          storageKey: storageKey

    ContractListResponse:
      title: List of contracts JSON
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - contractId
          - header
          - state
          - body
        properties:
          contractId:
            type: string
          header:
            $ref: '#/components/schemas/ContractRequest_header2'
          state:
            type: string
            enum: [DRAFT, PENDING, SENT, RECEIVED]
          referenceId:
            type: string
          body:
            type: object
            additionalProperties: false
            required:
              - metadata
              - framework
            properties:
              metadata:
                type: object
                additionalProperties: false
                properties:
                  name:
                    $ref: '#/components/schemas/StringOrNull'
                  authors:
                    $ref: '#/components/schemas/StringOrNull'
              framework:
                type: object
                additionalProperties: false
                properties:
                  term:
                    $ref: '#/components/schemas/ObjectOrNull'
                  partyInformation:
                    $ref: '#/components/schemas/ObjectOrNull'
          creationDate:
            $ref: '#/components/schemas/Date'
          lastModificationDate:
            $ref: '#/components/schemas/Date'
      example:
      - contractId: "6086ec7f7146de001fefc02004cf"
        header:
          type: contract
          version: "1.1"
          msps:
            DTAG:
              signatures: []
            TMUS:
              signatures: []
        state: SENT
        body:
          metadata:
            name: Contract number 1
            authors: null
          framework:
            term:
              start: 2020-01-01T00:00:00.000Z
              end: 2020-12-31T00:00:00.000Z
            partyInformation: null
      - contractId: "6086a6e990658f001f8fdf5e40f3"
        header:
          type: contract
          version: "2.4"
          msps:
            DTAG:
              signatures: []
            TMUS:
              signatures: []
        state: DRAFT
        body:
          metadata:
            name: Another contract number 8
            authors: me
          framework:
            term:
              start: 2019-01-01T00:00:00.000Z
              end: 2019-12-31T00:00:00.000Z
            partyInformation: null
                  
    ContractResponse:
      title: Contract JSON
      type: object
      additionalProperties: false
      required:
        - contractId
        - header
        - state
        - body
      properties:
        contractId:
          type: string
          description: ContractId in GUID format
          example: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        header:
          type: object
          additionalProperties: false
          required:
            - version
            - type
            - msps
          properties:
            name:
              type: string
              description: Human readable name for the contract.
            version:
              type: string
              description: Version of the contract
            type:
              type: string
              description: Type of document. MUST be "contract"
              enum: [contract]
            msps:
              type: object
              minProperties: 2
              additionalProperties:
                $ref: '#/components/schemas/ContractRequest_header2_msp'
          example:
            name: Contract with XYZ
            version: "1.0"
            type: contract
            msps:
              DTAG:
                signatures:
                - id: id-signature-DTAG-1
                  name: name-signature-DTAG-1
                  role: role-signature-DTAG-1
                - id: id-signature-DTAG-2
                  name: name-signature-DTAG-2
                  role: role-signature-DTAG-2
              TMUS:
                signatures:
                - id: id-signature-TMUS-1
                  name: name-signature-TMUS-1
                  role: role-signature-TMUS-1
        state:
          type: string
          description: The State of the Contract.
          enum: [DRAFT, PENDING, SENT, RECEIVED]
        referenceId:
          type: string
        blockchainRef:
          $ref: '#/components/schemas/BlockchainRef'
        body:
          $ref: '#/components/schemas/ContractBody'
        creationDate:
          $ref: '#/components/schemas/Date'
        lastModificationDate:
          $ref: '#/components/schemas/Date'
      # Define example to force the fields order ( but not needed otherwise )
      example:
        contractId: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        header:
          name: Contract with XYZ
          version: "1.0"
          type: contract
          msps:
            DTAG:
              signatures:
              - id: id-signature-DTAG-1
                name: name-signature-DTAG-1
                role: role-signature-DTAG-1
              - id: id-signature-DTAG-2
                name: name-signature-DTAG-2
                role: role-signature-DTAG-2
            TMUS:
              signatures:
              - id: id-signature-TMUS-1
                name: name-signature-TMUS-1
                role: role-signature-TMUS-1
        state: DRAFT
        body:
          version: 0.0.2-MVP1
          metadata:
            name: Contract-Name-Chosen
            authors: author1 & author2
          framework:
            term:
              start: 2020-01-01T00:00:00.000Z
              end: 2020-12-31T00:00:00.000Z
            payment:
              taxesIncluded: false
          discounts:
            MSP-1:
              condition:
                kind: Unconditional
              serviceGroups:
              - homeTadigs:
                - MSP-1--TADIG-1
                - MSP-1--TADIG-2
                visitorTadigs:
                - MSP-23--TADIG-7
                - MSP-23--TADIG-8
                - MSP-23--TADIG-9
                services:
                - service: MOC Local
                  usagePricing:
                    unit: Min
                    ratingPlan:
                      kind: Linear rate
                      rate:
                        linearPrice: 0.145
                - service: SMSMO
                  usagePricing:
                    unit: SMS
                    ratingPlan:
                      rate:
                        thresholds:
                        - start: 0
                          linearPrice: 0.256
                        - start: 5000
                          linearPrice: 0.05
            MSP-23:
              condition:
                kind: Deal Revenue Commitment
                commitment:
                  value: 235000,
                  currency: EUR
                  includingTaxes: false
              serviceGroups:
              - homeTadigs:
                - MSP-23--TADIG-7
                - MSP-23--TADIG-8
                - MSP-23--TADIG-9
                visitorTadigs:
                - MSP-1--TADIG-1
                - MSP-1--TADIG-2
                services:
                - service: MOC Back Home
                  usagePricing:
                    unit: Min
                    ratingPlan:
                      kind: Linear rate
                      rate:
                        linearPrice: 0.023
                - service: GPRS
                  usagePricing:
                    unit: MB
                    ratingPlan:
                      rate:
                        thresholds:
                        - start: 0
                          linearPrice: 0.0035
                        - start: 70000
                          linearPrice: 0.0015
        creationDate: 2021-01-01T15:30:10.801Z
        lastModificationDate: 2021-01-01T15:30:10.801Z

    RAWContractResponse:
      title: Contract RAW
      type: object
      additionalProperties: false
      required:
        - contractId
        - state
        - referenceId
        - blockchainRef
        - raw
      properties:
        contractId:
          type: string
          description: ContractId in GUID format
          example: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        state:
          type: string
          description: The State of the Contract.
          enum: [DRAFT, PENDING, SENT, RECEIVED]
        referenceId:
            type: string
        blockchainRef:
          $ref: '#/components/schemas/BlockchainRef'
        raw:
          type: string
          description: Original Base64 encoded RAW payload, Used for Hash calculation or Signing.
          example: eyJoZWFkZXIiOnsidmVyc2lvbiI6IjEuM....
        creationDate:
          $ref: '#/components/schemas/Date'
        lastModificationDate:
          $ref: '#/components/schemas/Date'

    ContractResponseOrRAWContractResponse:
      type: object
      oneOf:
      - $ref: '#/components/schemas/ContractResponse'
      - $ref: '#/components/schemas/RAWContractResponse'
      # Define example to force the ContractResponse example to be displayed ( but not needed otherwise )
      example:
        contractId: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        header:
          name: Contract with XYZ
          version: "1.0"
          type: contract
          msps:
            DTAG:
              signatures:
              - id: id-signature-DTAG-1
                name: name-signature-DTAG-1
                role: role-signature-DTAG-1
              - id: id-signature-DTAG-2
                name: name-signature-DTAG-2
                role: role-signature-DTAG-2
            TMUS:
              signatures:
              - id: id-signature-TMUS-1
                name: name-signature-TMUS-1
                role: role-signature-TMUS-1
        state: DRAFT
        body:
          version: 0.0.2-MVP1
          metadata:
            name: Contract-Name-Chosen
            authors: author1 & author2
          framework:
            term:
              start: 2020-01-01T00:00:00.000Z
              end: 2020-12-31T00:00:00.000Z
            payment:
              taxesIncluded: false
          discounts:
            MSP-1:
              condition:
                kind: Unconditional
              serviceGroups:
              - homeTadigs:
                - MSP-1--TADIG-1
                - MSP-1--TADIG-2
                visitorTadigs:
                - MSP-23--TADIG-7
                - MSP-23--TADIG-8
                - MSP-23--TADIG-9
                services:
                - service: MOC Local
                  usagePricing:
                    unit: Min
                    ratingPlan:
                      kind: Linear rate
                      rate:
                        linearPrice: 0.145
                - service: SMSMO
                  usagePricing:
                    unit: SMS
                    ratingPlan:
                      rate:
                        thresholds:
                        - start: 0
                          linearPrice: 0.256
                        - start: 5000
                          linearPrice: 0.05
            MSP-23:
              condition:
                kind: Deal Revenue Commitment
                commitment:
                  value: 235000,
                  currency: EUR
                  includingTaxes: false
              serviceGroups:
              - homeTadigs:
                - MSP-23--TADIG-7
                - MSP-23--TADIG-8
                - MSP-23--TADIG-9
                visitorTadigs:
                - MSP-1--TADIG-1
                - MSP-1--TADIG-2
                services:
                - service: MOC Back Home
                  usagePricing:
                    unit: Min
                    ratingPlan:
                      kind: Linear rate
                      rate:
                        linearPrice: 0.023
                - service: GPRS
                  usagePricing:
                    unit: MB
                    ratingPlan:
                      rate:
                        thresholds:
                        - start: 0
                          linearPrice: 0.0035
                        - start: 70000
                          linearPrice: 0.0015

    ContractRequest:
      title: Contract JSON for POST/PUT
      type: object
      properties:
        header:
          type: object
          oneOf:
          - $ref: '#/components/schemas/ContractRequest_header'
          - $ref: '#/components/schemas/ContractRequest_header2'
          example:
            name: Contract with XYZ
            type: contract
            version: "1.0"
            msps:
              DTAG:
                signatures:
                - id: id-signature-DTAG-1
                  name: name-signature-DTAG-1
                  role: role-signature-DTAG-1
                - id: id-signature-DTAG-2
                  name: name-signature-DTAG-2
                  role: role-signature-DTAG-2
              TMUS:
                signatures:
                - id: id-signature-TMUS-1
                  name: name-signature-TMUS-1
                  role: role-signature-TMUS-1
        body:
          $ref: '#/components/schemas/ContractBody'
      additionalProperties: false
      required:
        - header
        - body

    SignatureBase:
      type: object
      example:
        role: role
        name: name
        id: id
      properties:
        id:
          type: string
        name:
          type: string
        role:
          type: string

    SignatureListResponse:
      title: List of signatures JSON
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - signatureId
          - contractId
          - msp
          - state
        properties:
          signatureId:
            type: string
          contractId:
            type: string
          msp:
            type: string
          state:
            type: string
      example:
      - signatureId: "6086a6e990658f001f8fdf5e40f3"
        contractId: "6086ec7f7146de001fefc02004cf"
        msp: DTAG
        state: SIGNED
      - signatureId: "7196a6e990658f001f8fdf5e40f3"
        contractId: "7196ec7f7146de001fefc02004cf"
        msp: TMUS
        state: SIGNED

    SignatureResponse:
      title: Signature JSON
      type: object
      additionalProperties: false
      required:
        - signatureId
        - contractId
        - msp
        - state
      properties:
        signatureId:
          type: string
        contractId:
          type: string
        msp:
          type: string
        state:
          type: string
        algorithm:
          description: The algorithm used to sign
          type: string
        certificate:
          description: The certificate of the signer in pem format
          type: string
        signature:
          description: The digital signature over the document
          type: string
        extra:
          type: object
          description: Additional Key/Value from \"signature\"->\"\<mspId\>\"[X]->XXX, eg name, role
        blockchainRef:
          $ref: '#/components/schemas/BlockchainRef'
      example:
        signatureId: "6086a6e990658f001f8fdf5e40f3"
        contractId: "6086ec7f7146de001fefc02004cf"
        msp: DTAG
        state: SIGNED
        algorithm: secp384r1
        certificate: |-
            -----BEGIN CERTIFICATE-----
            MIICYjCCAemgAwIBA...
        signature: signature
        extra: '{"name":"john doe", "role":"manager"}'

    SignatureRequest:
      title: Signature JSON for PUT
      type: object
      properties:
        algorithm:
          description: The algorithm used to sign
          example: secp384r1
          type: string
        certificate:
          description: The certificate of the signer in pem format
          example: |-
            -----BEGIN CERTIFICATE-----
            MIICYjCCAemgAwIBA...
          type: string
        signature:
          description: The digital signature over the document
          type: string
      additionalProperties: false
      required:
      - algorithm
      - certificate
      - signature

    UsageListResponse:
      title: List of usages JSON
      type: array
      items:
        type: object
        properties:
          usageId:
            type: string
          contractId:
            type: string
          header:
            type: object
            properties:
              name:
                type: string
              version:
                type: string
              type:
                type: string
                enum: [usage]
          state:
            type: string
            enum: [DRAFT, PENDING, SENT, RECEIVED]
          mspOwner:
            type: string
      example:
      - usageId: "6086a6f090658f001f8fdf601ce3"
        contractId: "6086ec7f7146de001fefc02004cf"
        header:
          type: usage
          version: "1.1"
          name: Usage from DTAG to TMUS created the 2021-04-26T11:41:29.112Z
        state: DRAFT
        mspOwner: DTAG
      - usageId: "7086a6f090658f001f8fdf601ce3"
        contractId: "7086ec7f7146de001fefc02004cf"
        header:
          type: usage
          version: "3.2"
          name: Usage from TMUS to DTAG created the 2020-03-29T17:11:22.012Z
        state: RECEIVED
        mspOwner: TMUS

    UsageResponse:
      title: Usage JSON
      type: object
      additionalProperties: false
      required:
        - usageId
        - contractId
        - header
        - state
        - mspOwner
        - body
      properties:
        usageId:
          type: string
          example: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        contractId:
          type: string
          example: 04552c4c-e52f-4bb5-83d2-f50c86115bc0
        header:
          type: object
          additionalProperties: false
          required:
            - version
            - type
          properties:
            name:
              type: string
              description: Human readable name for the usage.
              example: Usage, from ABC to XYZ
            version:
              type: string
              description: Version of the usage
              example: 1.0
            type:
              type: string
              description: Type of document. MUST be "usage"
              enum: [usage]
            mspOwner:
              type: string
              description: the Msp which gives the Inbound traffic data
        state:
          type: string
          description: The State of the Usage.
          enum: [DRAFT, SENT, RECEIVED]
        mspOwner:
            type: string
        referenceId:
            type: string
        blockchainRef:
          $ref: '#/components/schemas/BlockchainRef'
        settlementId:
            type: string
        body:
          $ref: '#/components/schemas/UsageBody'
        creationDate:
          $ref: '#/components/schemas/Date'
        lastModificationDate:
          $ref: '#/components/schemas/Date'
      # Define example to force the fields order ( but not needed otherwise )
      example:
        usageId: 05552c4c-e52f-4bb5-83d2-f50c86115bc8
        contractId: 04552c4c-e52f-4bb5-83d2-f50c86115bc0
        header:
          mspOwner: mspOwner
          name: Usage, from ABC to XYZ
          type: usage
          version: "1.0"
        state: DRAFT
        mspOwner: mspOwner
        settlementId: settlementId
        body:
          metadata:
            name: Usage-Name-Chosen
            authors: author3
          inbound:
          - yearMonth: "20200103"
            homeTadig: mspB-tadig4
            visitorTadig: mspA-tadig8
            service: MOC Local
            usage: 490
            units: min
            currency: EUR
          - yearMonth: "20200104"
            homeTadig: mspB-tadig7
            visitorTadig: mspA-tadig6
            service: MOC Home
            usage: 677246
            units: min
            currency: EUR
          - yearMonth: "20200104"
            homeTadig: mspB-tadig6
            visitorTadig: mspA-tadig1
            service: MOC International
            usage: 80434
            units: min
            currency: EUR
          outbound:
          - yearMonth: "20200101"
            homeTadig: mspA-tadig1
            visitorTadig: mspB-tadig9
            service: SMSMO
            usage: 3
            units: SMS
            currency: EUR
          - yearMonth: "20200101"
            homeTadig: mspA-tadig2
            visitorTadig: mspB-tadig5
            service: GPRS
            usage: 6.007386755E7
            units: MB
            currency: EUR
        creationDate: 2021-01-01T15:30:10.801Z
        lastModificationDate: 2021-01-01T15:30:10.801Z

    UsageRequest:
      title: Usage JSON for POST/PUT
      type: object
      additionalProperties: false
      required:
        - header
        - body
      properties:
        header:
          type: object
          additionalProperties: false
          required:
            - version
            - type
          properties:
            name:
              type: string
              description: Human readable name for the usage.
              example: Usage, from ABC to XYZ
            version:
              type: string
              description: Version of the usage
              example: 1.0
            type:
              type: string
              description: Type of document. MUST be "usage"
              enum: [usage]
        state:
          type: string
          description: The State of the Usage.
          enum: [DRAFT, SENT, RECEIVED]
        body:
          $ref: '#/components/schemas/UsageBody'

    UsageDiscrepancy_general_information_item:
      type: object
      additionalProperties: false
      required:
        - service
        - unit
        - inbound_own_usage
        - inbound_partner_usage
        - inbound_discrepancy
        - outbound_own_usage
        - outbound_partner_usage
        - outbound_discrepancy
      properties:
        service:
          type: string
          enum: [MOC, SMS, Data, MTC]
        unit:
          type: string
        inbound_own_usage:
          type: number
        inbound_partner_usage:
          type: number
        inbound_discrepancy:
          type: number
        outbound_own_usage:
          type: number
        outbound_partner_usage:
          type: number
        outbound_discrepancy:
          type: number

    UsageDiscrepancy_service_item:
      type: object
      additionalProperties: false
      required:
        - HTMN
        - VPMN
        - yearMonth
        - service
        - own_usage
        - partner_usage
        - delta_usage_abs
        - delta_usage_percent
      properties:
        HTMN:
          type: string
        VPMN:
          type: string
        yearMonth:
          type: string
        service:
          type: string
        own_usage:
          type: number
        partner_usage:
          type: number
        delta_usage_abs:
          type: number
        delta_usage_percent:
          type: number

    UsageDiscrepancy:
      title: Usage Discrepancy JSON
      type: object
      additionalProperties: false
      required:
        - general_information
        - inbound
        - outbound
      properties:
        general_information:
          type: array
          minItems: 3
          maxItems: 4
          items:
            $ref: '#/components/schemas/UsageDiscrepancy_general_information_item'
        inbound:
          type: array
          items:
            $ref: '#/components/schemas/UsageDiscrepancy_service_item'
        outbound:
          type: array
          items:
            $ref: '#/components/schemas/UsageDiscrepancy_service_item'
      example:
        general_information:
        - service: MOC
          unit: unit
          inbound_own_usage: 109888639.04999995
          inbound_partner_usage: 109888639.04999995
          inbound_discrepancy: 0
          outbound_own_usage: 78883740.15000007
          outbound_partner_usage: 78883740.15000007
          outbound_discrepancy: 0
        - service: SMS
          unit: SMS
          inbound_own_usage: 16582071
          inbound_partner_usage: 16582071
          inbound_discrepancy: 0
          outbound_own_usage: 13862811
          outbound_partner_usage: 13862811
          outbound_discrepancy: 0
        - service: Data
          unit: MB
          inbound_own_usage: 512171795.639366
          inbound_partner_usage: 512171795.639366
          inbound_discrepancy: 0
          outbound_own_usage: 434032331.7315726
          outbound_partner_usage: 434032331.7315726
          outbound_discrepancy: 0
        - service: MTC
          unit: min
          inbound_own_usage: 705946.19999993
          inbound_partner_usage: 705946.19999993
          inbound_discrepancy: 0
          outbound_own_usage: 73890.45
          outbound_partner_usage: 73890.45
          outbound_discrepancy: 0
        inbound:
        - HTMN: HTMN
          VPMN: VPMN
          yearMonth: "202001"
          service: SMSMO
          own_usage: 702
          partner_usage: 702
          delta_usage_abs: 0
          delta_usage_percent: 0
        - HTMN: HTMN
          VPMN: VPMN
          yearMonth: "202002"
          service: GPRS
          own_usage: 2757833.36439228
          partner_usage: 2757833.36439228
          delta_usage_abs: 0
          delta_usage_percent: 0
        outbound:
        - HTMN: HTMN
          VPMN: VPMN
          yearMonth: "202010"
          service: MOC International
          own_usage: 226.85
          partner_usage: 226.85
          delta_usage_abs: 0
          delta_usage_percent: 0
        - HTMN: HTMN
          VPMN: VPMN
          yearMonth: "202011"
          service: MTC
          own_usage: 9854.300
          partner_usage: 9854.300
          delta_usage_abs: 0
          delta_usage_percent: 0

    SettlementDiscrepancy_general_information_item:
      type: object
      additionalProperties: false
      required:
        - own_calculation
        - partner_calculation
        - delta_calculation_percent
      properties:
        bearer:
          type: string
        service:
          type: string
        unit:
          type: string
        own_calculation:
          type: number
        partner_calculation:
          type: number
        delta_calculation_percent:
          type: number
        own_usage:
          type: number
        partner_usage:
          type: number
        delta_usage_abs:
          type: number
        delta_usage_percent:
          type: number

    SettlementDiscrepancy_details_item:
      type: object
      additionalProperties: false
      required:
        - service
        - unit
        - own_calculation
        - partner_calculation
        - delta_calculation_percent
      properties:
        service:
          type: string
        unit:
          type: string
        own_calculation:
          type: number
        partner_calculation:
          type: number
        delta_calculation_percent:
          type: number
        own_usage:
          type: number
        partner_usage:
          type: number
        delta_usage_abs:
          type: number
        delta_usage_percent:
          type: number

    SettlementDiscrepancy_perspective:
      type: object
      additionalProperties: false
      required:
        - general_information
        - details
      properties:
        general_information:
          type: array
          minItems: 3
          maxItems: 3
          items:
            $ref: '#/components/schemas/SettlementDiscrepancy_general_information_item'
        details:
          type: array
          items:
            $ref: '#/components/schemas/SettlementDiscrepancy_details_item'

    SettlementDiscrepancy:
      title: Settlement Discrepancy JSON
      type: object
      additionalProperties: false
      required:
        - homePerspective
        - partnerPerspective
      properties:
        homePerspective:
          $ref: '#/components/schemas/SettlementDiscrepancy_perspective'
        partnerPerspective:
          $ref: '#/components/schemas/SettlementDiscrepancy_perspective'
      example:
        homePerspective:
          general_information:
          - service: Voice
            unit: min
            own_calculation: 19120680.994
            partner_calculation: 19120680.994
            delta_calculation_percent: 0
          - service: SMS
            unit: SMS
            own_calculation: 198984.852
            partner_calculation: 198984.852
            delta_calculation_percent: 0
          - service: Data
            unit: MB
            own_calculation: 30146061.547672395
            partner_calculation: 30146061.547672395
            delta_calculation_percent: 0
          details:
          - service: MOC Local
            unit: min
            own_calculation: 668295.9319999999
            partner_calculation: 668295.9319999999
            delta_calculation_percent: 0
          - service: SMSMO
            unit: SMS
            own_calculation: 198984.852
            partner_calculation: 198984.852
            delta_calculation_percent: 0
        partnerPerspective:
          general_information:
          - service: Voice
            unit: min
            own_calculation: 19120680.994
            partner_calculation: 19120680.994
            delta_calculation_percent: 0
          - service: SMS
            unit: SMS
            own_calculation: 198984.852
            partner_calculation: 198984.852
            delta_calculation_percent: 0
          - service: Data
            unit: MB
            own_calculation: 30146061.547672395
            partner_calculation: 30146061.547672395
            delta_calculation_percent: 0
          details:
          - service: MOC Local
            unit: min
            own_calculation: 668295.9319999999
            partner_calculation: 668295.9319999999
            delta_calculation_percent: 0
          - service: SMSMO
            unit: SMS
            own_calculation: 198984.852
            partner_calculation: 198984.852
            delta_calculation_percent: 0
                  
    SettlementListResponse:
      title: List of settlements JSON
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - settlementId
          - contractId
          - header
          - state
        properties:
          settlementId:
            type: string
            example: "608a6e60a01f88001e80a3fb4de1"
          contractId:
            type: string
            example: "6086a6e990658f001f8fdf5e40f3"
          header:
            type: object
            additionalProperties: false
            required:
              - version
              - type
            properties:
              name:
                type: string
              version:
                type: string
              type:
                type: string
                enum: [settlement]
            example:
              type: "settlement"
              version: "1.0.0"
          state:
            type: string
            enum: [DRAFT, SENT, RECEIVED]
            example: DRAFT
          creationDate:
            $ref: '#/components/schemas/Date'
          lastModificationDate:
            $ref: '#/components/schemas/Date'
      example:
      - settlementId: 398a6e60a01f88001e80a3fb4de1
        contractId: 3986a6e990658f001f8fdf5e40f3
        header:
          type: settlement
          version: 1.0.0
        state: SENT
      - settlementId: 608a6e60a01f88001e80a3fb4de2
        contractId: 6086a6e990658f001f8fdf5e40f4
        header:
          type: settlement
          version: 5.2.0
        state: RECEIVED
      
    SettlementResponse:
      title: Settlement JSON
      type: object
      additionalProperties: false
      required:
        - contractId
        - header
        - state
        - mspOwner
        - body
      properties:
        settlementId:
          type: string
          example: "608a6e60a01f88001e80a3fb4de1"
        contractId:
          type: string
          example: "6086a6e990658f001f8fdf5e40f3"
        header:
          type: object
          additionalProperties: false
          required:
            - version
            - type
          properties:
            name:
              type: string
            version:
              type: string
            type:
              type: string
              enum: [settlement]
          example:
            type: "settlement"
            version: "1.0.0"
        state:
          type: string
          enum: [DRAFT, SENT, RECEIVED]
          example: DRAFT
        mspOwner:
          type: string
          example: DTAG
        referenceId:
            type: string
        blockchainRef:
          $ref: '#/components/schemas/BlockchainRef'
        usageId:
            type: string
        body:
          $ref: '#/components/schemas/SettlementBody'
        creationDate:
          $ref: '#/components/schemas/Date'
        lastModificationDate:
          $ref: '#/components/schemas/Date'
      # Define example to force the fields order ( but not needed otherwise )
      example:
        settlementId: 608a6e60a01f88001e80a3fb4de1
        contractId: 6086a6e990658f001f8fdf5e40f3
        header:
          type: settlement
          version: 1.0.0
        state: DRAFT
        mspOwner: DTAG
        body:
          fromDate: 202001
          toDate: 202012
          calculationEngineVersion: 0.0.1
          inbound:
            tax:
              rate: ""
            currency: EUR
            services:
              voice:
                MOC:
                  local: 0
                  backHome: 0
                  international: 0
                  premium: 0
                  ROW: 0
                  EU: 0
                  EEA: 0
                  satellite: 0
                  videoTelephony: 0
                  specialDestinations: 0
                MTC: 0
              SMS:
                MO: 0
                MT: 0
              data:
              - name: GPRS
                value: 0
              - name: M2M
                value: 0
              - name: NB-IOT
                value: 0
              - name: LTE-M
                value: 0
              - name: VoLTE
                value: 0
              - name: ViLTE
                value: 0
              - name: signalling
                value: 0
              access:
                networkAccess: 0
          outbound:
            tax:
              rate: ""
            currency: EUR
            services:
              voice:
                MOC:
                  local: 0
                  backHome: 0
                  international: 0
                  premium: 0
                  ROW: 0
                  EU: 0
                  EEA: 0
                  satellite: 0
                  videoTelephony: 0
                  specialDestinations: 0
                MTC: 0
              SMS:
                MO: 0
                MT: 0
              data:
              - name: GPRS
                value: 0
              - name: M2M
                value: 0
              - name: NB-IOT
                value: 0
              - name: LTE-M
                value: 0
              - name: VoLTE
                value: 0
              - name: ViLTE
                value: 0
              - name: signalling
                value: 0
              access:
                networkAccess: 0
          unexpectedServiceNames: []

    EventResponse:
      title: Event Response JSON
      type: array
      items:
        type: object
        additionalProperties: false
        required:
          - id
          - type
          - referenceId
        properties:
          id:
            type: string
          type:
            type: string
          referenceId:
            type: string
          contractId:
            type: string
        example:
          id: id
          type: contract
          referenceId: referenceId

    400ErrorResponse:
      title: 400 Error Response JSON
      type: object
      properties:
        error:
          type: string
          description: a list of pre-defined error names
          example: invalid_request
        description:
          type: string
          description: Text Description of the error
          example: The Request is invalid
      required:
        - error
        - description

    ContractRequest_header_fromMsp:
      example:
        mspId: DTAG
        signatures:
        - role: role
          name: name
          id: id
        - role: role
          name: name
          id: id
      properties:
        mspId:
          description: mspId of the contract creator.
          example: DTAG
          type: string
        signatures:
          items:
            $ref: '#/components/schemas/SignatureBase'
          minItems: 1
          type: array
      type: object

    ContractRequest_header_toMsp:
      example:
        mspId: TMUS
        signatures:
        - role: role
          name: name
          id: id
        - role: role
          name: name
          id: id
      properties:
        mspId:
          description: mspId of the contract creator.
          example: TMUS
          type: string
        signatures:
          items:
            $ref: '#/components/schemas/SignatureBase'
          minItems: 1
          type: array
      type: object

    ContractRequest_header:
      example:
        fromMsp:
          mspId: DTAG
          signatures:
          - role: role
            name: name
            id: id
          - role: role
            name: name
            id: id
        name: Contract with XYZ
        toMsp:
          mspId: TMUS
          signatures:
          - role: role
            name: name
            id: id
          - role: role
            name: name
            id: id
        type: contract
        version: "1.0"
      properties:
        name:
          type: string
          description: Human readable name for the contract.
          example: Contract with XYZ
        version:
          type: string
          description: Version of the contract
          example: 1.0
        type:
          type: string
          description: Type of document. MUST be "contract"
          enum: [contract]
        fromMsp:
          $ref: '#/components/schemas/ContractRequest_header_fromMsp'
        toMsp:
          $ref: '#/components/schemas/ContractRequest_header_toMsp'
      required:
        - version
        - type
        - fromMsp
        - toMsp

    ContractRequest_header2_msp:
      type: object
      additionalProperties: true
      properties:
        signatures:
          type: array
          items:
            $ref: '#/components/schemas/SignatureBase'
      example:
        signatures:
        - role: role
          name: name
          id: id
        - role: role
          name: name
          id: id

    ContractRequest_header2:
      type: object
      additionalProperties: true
      properties:
        name:
          description: Human readable name for the contract.
          example: Contract with XYZ
          type: string
        version:
          description: Version of the contract
          example: "1.0"
          type: string
        type:
          description: Type of document. MUST be "contract"
          enum:
          - contract
          type: string
        msps:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ContractRequest_header2_msp'
      required:
      - version
      - type
      - msps

    ContractBody_msp_discount_serviceGroup_service_rate_threshold:
      type: object
      additionalProperties: true
      properties:
        start:
          type: number
        fixedPrice:
          type: number
        linearPrice:
          type: number

    ContractBody_msp_discount_serviceGroup_service:
      type: object
      additionalProperties: true
      properties:
        service:
          type: string
        usagePricing:
          type: object
          additionalProperties: true
          properties:
            unit:
              type: string
            ratingPlan:
              type: object
              additionalProperties: true
              properties:
                kind:
                  type: string
                balancedRate:
                  type: object
                  additionalProperties: true
                  properties:
                    linearPrice:
                      type: number
                    thresholds:
                      type: array
                      items:
                        $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup_service_rate_threshold'
                      minItems: 1
                unbalancedRate:
                  type: object
                  additionalProperties: true
                  properties:
                    thresholds:
                      type: array
                      items:
                        $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup_service_rate_threshold'
                      minItems: 1
                rate:
                  type: object
                  additionalProperties: true
                  properties:
                    thresholds:
                      type: array
                      items:
                        $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup_service_rate_threshold'
                      minItems: 1
        accessPricing:
          type: object
          additionalProperties: true
          properties:
            unit:
              type: string
            ratingPlan:
              type: object
              additionalProperties: true
              properties:
                kind:
                  type: string
                rate:
                  type: object
                  additionalProperties: true
                  properties:
                    linearPrice:
                      type: number
                    thresholds:
                      type: array
                      items:
                        $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup_service_rate_threshold'

    ContractBody_msp_discount_serviceGroup:
      type: object
      additionalProperties: true
      properties:
        homeTadigs:
          type: array
          items:
            type: string
          minItems: 1
        visitorTadigs:
          type: array
          items:
            type: string
          minItems: 1
        services:
          type: array
          items:
            $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup_service'

    ContractBody_msp_discount:
      type: object
      additionalProperties: true
      properties:
        condition:
          type: object
          additionalProperties: true
        serviceGroups:
          type: array
          items:
            $ref: '#/components/schemas/ContractBody_msp_discount_serviceGroup'

    ContractBody:
      type: object
      additionalProperties: true
      properties:
        version:
          type: string
        metadata:
          type: object
          additionalProperties: true
          properties:
            name:
              type: string
            authors:
              type: string
        discounts:
          type: object
          minProperties: 2
          maxProperties: 2
          additionalProperties:
            $ref: '#/components/schemas/ContractBody_msp_discount'
        framework:
          type: object
          additionalProperties: true
          properties:
            term:
              type: object
              additionalProperties: true
            payment:
              type: object
              additionalProperties: true
            partyInformation:
              type: object
              additionalProperties: true
      example:
        version: 0.0.2-MVP1
        metadata:
          name: Contract-Name-Chosen
          authors: author1 & author2
        framework:
          term:
            start: 2020-01-01T00:00:00.000Z
            end: 2020-12-31T00:00:00.000Z
          payment:
            taxesIncluded: false
        discounts:
          MSP-1:
            condition:
              kind: "Unconditional"
            serviceGroups:
            - homeTadigs:
              - "MSP-1--TADIG-1"
              - "MSP-1--TADIG-2"
              visitorTadigs:
              - "MSP-23--TADIG-7"
              - "MSP-23--TADIG-8"
              - "MSP-23--TADIG-9"
              services:
              - service: "MOC Local"
                usagePricing:
                  unit: "Min"
                  ratingPlan:
                    kind: "Linear rate"
                    rate:
                      linearPrice: 0.145
              - service: "SMSMO"
                usagePricing:
                  unit: "SMS"
                  ratingPlan:
                    rate:
                      thresholds:
                      - start: 0
                        linearPrice: 0.256
                      - start: 5000
                        linearPrice: 0.050
          MSP-23:
            condition:
              kind: "Deal Revenue Commitment"
              commitment:
                value: 235000,
                currency: "EUR"
                includingTaxes: false
            serviceGroups:
            - homeTadigs:
              - "MSP-23--TADIG-7"
              - "MSP-23--TADIG-8"
              - "MSP-23--TADIG-9"
              visitorTadigs:
              - "MSP-1--TADIG-1"
              - "MSP-1--TADIG-2"
              services:
              - service: "MOC Back Home"
                usagePricing:
                  unit: "Min"
                  ratingPlan:
                    kind: "Linear rate"
                    rate:
                      linearPrice: 0.023
              - service: "GPRS"
                usagePricing:
                  unit: "MB"
                  ratingPlan:
                    rate:
                      thresholds:
                      - start: 0
                        linearPrice: 0.0035
                      - start: 70000
                        linearPrice: 0.0015
              
    UsageBody_usage_item:
      type: object
      additionalProperties: true
      properties:
        yearMonth:
          type: string
        homeTadig:
          type: string
        visitorTadig:
          type: string
        service:
          type: string
        usage:
          type: number
        units:
          type: string
        currency:
          type: string
      required:
        - yearMonth
        - homeTadig
        - visitorTadig
        - service
        - usage

    UsageBody:
      type: object
      additionalProperties: true
      properties:
        metadata:
          type: object
          additionalProperties: true
          properties:
            name:
              type: string
            authors:
              type: string
          example:
            name: Usage-Name-Chosen
            authors: author3
        inbound:
          type: array
          items:
            $ref: '#/components/schemas/UsageBody_usage_item'
          example:
          - yearMonth: "20200103"
            homeTadig: "mspB-tadig4"
            visitorTadig: "mspA-tadig8"
            service: "MOC Local"
            usage: 490
            units: "min"
            currency: "EUR"
          - yearMonth: "20200104"
            homeTadig: "mspB-tadig7"
            visitorTadig: "mspA-tadig6"
            service: "MOC Home"
            usage: 677246
            units: "min"
            currency: "EUR"
          - yearMonth: "20200104"
            homeTadig: "mspB-tadig6"
            visitorTadig: "mspA-tadig1"
            service: "MOC International"
            usage: 80434
            units: "min"
            currency: "EUR"
        outbound:
          type: array
          items:
            $ref: '#/components/schemas/UsageBody_usage_item'
          example:
          - yearMonth: "20200101"
            homeTadig: "mspA-tadig1"
            visitorTadig: "mspB-tadig9"
            service: "SMSMO"
            usage: 3
            units: "SMS"
            currency: "EUR"
          - yearMonth: "20200101"
            homeTadig: "mspA-tadig2"
            visitorTadig: "mspB-tadig5"
            service: "GPRS"
            usage: 60073867.55
            units: "MB"
            currency: "EUR"

    SettlementBody_settlement_item:
      type: object
      additionalProperties: true
      properties:
        tax:
          type: object
          properties:
            rate:
              type: string
        currency:
          type: string
        services:
          type: object
          properties:
            voice:
              type: object
              properties:
                MOC:
                  type: object
                  properties:
                    local:
                      type: number
                    backHome:
                      type: number
                    international:
                      type: number
                    premium:
                      type: number
                    ROW:
                      type: number
                    EU:
                      type: number
                    EEA:
                      type: number
                    satellite:
                      type: number
                    videoTelephony:
                      type: number
                    specialDestinations:
                      type: number
                  required:
                    - local
                    - backHome
                    - international
                    - premium
                    - ROW
                    - EU
                    - EEA
                    - satellite
                    - videoTelephony
                    - specialDestinations
                MTC:
                  type: number
              required:
                - MOC
                - MTC
            SMS:
              type: object
              properties:
                MO:
                  type: number
                MT:
                  type: number
              required:
                - MO
                - MT
            data:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                    enum: [GPRS, M2M, NB-IOT, LTE-M, VoLTE, ViLTE, signalling]
                  value:
                    type: number
                required:
                  - name
                  - value
              minItems: 7
              maxItems: 7
            access:
              type: object
              properties:
                networkAccess:
                  type: number
              required:
                - networkAccess
          required:
            - voice
            - SMS
            - data
            - access
      required:
        - tax
        - currency
        - services

    SettlementBody:
      type: object
      additionalProperties: true
      properties:
        fromDate:
          type: number
          example: 202001
        toDate:
          type: number
          example: 202012
        calculationEngineVersion:
          type: string
          example: "0.0.1"
        inbound:
          $ref: '#/components/schemas/SettlementBody_settlement_item'
        outbound:
          $ref: '#/components/schemas/SettlementBody_settlement_item'
        unexpectedServiceNames:
          type: array
          items:
            type: string
          example:
          - "UNKNOWN SERVICE NAME IN USAGE"
      required:
        - fromDate
        - toDate
        - calculationEngineVersion
        - inbound
        - outbound
        - unexpectedServiceNames
      example:
        fromDate: 202001
        toDate: 202012
        calculationEngineVersion: "0.0.1"
        inbound:
          tax:
            rate: ""
          currency: EUR
          services:
            voice:
              MOC:
                local: 0
                backHome: 0
                international: 0
                premium: 0
                ROW: 0
                EU: 0
                EEA: 0
                satellite: 0
                videoTelephony: 0
                specialDestinations: 0
              MTC: 0
            SMS:
              MO: 0
              MT: 0
            data:
            - name: GPRS
              value: 0
            - name: M2M
              value: 0
            - name: NB-IOT
              value: 0
            - name: LTE-M
              value: 0
            - name: VoLTE
              value: 0
            - name: ViLTE
              value: 0
            - name: signalling
              value: 0
            access:
              networkAccess: 0
        outbound:
          tax:
            rate: ""
          currency: EUR
          services:
            voice:
              MOC:
                local: 0
                backHome: 0
                international: 0
                premium: 0
                ROW: 0
                EU: 0
                EEA: 0
                satellite: 0
                videoTelephony: 0
                specialDestinations: 0
              MTC: 0
            SMS:
              MO: 0
              MT: 0
            data:
            - name: GPRS
              value: 0
            - name: M2M
              value: 0
            - name: NB-IOT
              value: 0
            - name: LTE-M
              value: 0
            - name: VoLTE
              value: 0
            - name: ViLTE
              value: 0
            - name: signalling
              value: 0
            access:
              networkAccess: 0
        unexpectedServiceNames: []
 
